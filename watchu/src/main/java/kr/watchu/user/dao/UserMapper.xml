<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.watchu.user.dao.UserMapper">
	<!-- 회원목록 -->
	<select id="selectUserList" parameterType="map" resultType="userCommand">
		SELECT
		*
		FROM
		(SELECT a.*,
			ROWNUM rnum 
				FROM 
					(SELECT 
						* 
						FROM user_basic c 
						JOIN user_info i 
						ON c.id=i.id
		where i.id in
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")"> 
				#{item} 
			</foreach>
			<if test="keyword != ''">
				and i.name like '%' || #{keyword} || '%' or
				i.id like '%' || #{keyword} || '%'
			</if>
		ORDER BY i.reg_date DESC)a)
 	<![CDATA[
 		WHERE rnum >= #{start} AND rnum <= #{end}
 	]]>
	</select>
	
	<!-- 카운트 -->
	<select id="selectUserCnt" parameterType="map"
		resultType="integer">
		SELECT
		count(*)
		FROM user_info
		where id in
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")"> 
				#{item} 
			</foreach>
			<if test="keyword != ''">
				and name like '%' || #{keyword} || '%' or
				id like '%' || #{keyword} || '%'
			</if>		
	</select>
	
	<!-- 팔로잉,팔로워,블락 커맨드만 뽑음 -->
	<select id="selectfollowList" parameterType="map" resultType="userCommand">
			SELECT
			*
			FROM
			(SELECT a.*,
				ROWNUM rnum 
					FROM 
						(SELECT 
							* 
							FROM user_basic c 
							JOIN user_info i 
							ON c.id=i.id
			where i.id in
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")"> 
				#{item} 
			</foreach>
			
			<if test="keyword != ''">
				and	i.name like '%' || #{keyword} || '%' or
					i.id like '%' || #{keyword} || '%'
			</if>
			ORDER BY i.reg_date DESC)a)
	 	<![CDATA[
	 		WHERE rnum >= #{start} AND rnum <= #{end}
	 	]]>
	</select>
	<!-- 팔로잉,팔로워,블락 리스트 카운트 -->
	<select id="selectfollowCnt" parameterType="map"
		resultType="integer">
		SELECT
		count(*)
		FROM user_info
		where id in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")"> 
			#{item} 
		</foreach>
		
		<if test="keyword != ''">
			and	name like '%' || #{keyword} || '%' or
				id like '%' || #{keyword} || '%'
		</if>
		
		
		
	</select>
	
</mapper> 
